# File: .github/workflows/main.yaml

name: CI-CD Pipeline for Emotion Detector Application

on:
  push:
    branches:
      - main

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          lfs: true

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Cache Pip dependencies
        uses: actions/cache@v4
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-
      - name: Install dependencies
        run: pip install -r requirements.txt
      
      - name: Test Application Startup
        run: |
          python app.py &
          sleep 15
          kill $!

      # --- THIS IS THE FIX ---
      # Step 5: Push the code to Hugging Face Spaces using the correct action
      - name: Deploy to Hugging Face Spaces
        uses: gradio-app/gradio-spaces-action@v1 # <-- Correct action name
        with:
          hf_space: "ALYYAN/Emotion-Recognition" # <-- Your Space ID
          token: ${{ secrets.HF_TOKEN }}
          commit_message: "Automated deployment from GitHub Actions"
      # --- END FIX ---
